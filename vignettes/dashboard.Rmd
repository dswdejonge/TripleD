---
title: "Database dashboard"
output: html_document
---

# Data accuracy
To check the accuracy of raw and automatically generated data, some exploratory plots are made. These plots show the distribution of values in order to detect suspiscious values; e.g. suspiciously deep waters, or heavy animals.

```{r suspicous_depths, echo=FALSE}
plot <- ggplot(stations_additions) +
  geom_histogram(aes(x = Water_depth_m_Bathy)) +
  labs(
    title = "Suspicious water depths added?", 
    x = "Water depth from NOAA bathymetry resolution 1' (m)") +
  theme_bw()
plot
```

## Track length
```{r reported_vs_estimated_track_lengths, echo=FALSE}
#differences <- na.omit(abs(stations_additions$Water_depth_m - stations_additions$Water_depth_m_Bathy))
#avg_diff <- sum(differences) / length(differences)
tidy <- stations_additions %>%
  select(StationID, Track_dist_m, Track_dist_m_BB, Track_dist_m_GPS) %>%
  gather(Track_dist_m_GPS, Track_dist_m_BB, 
         key = "Sensor", value = "Estimated_length_m")
plot <- ggplot(
  tidy, 
  aes(
    x = Track_dist_m, 
    y = Estimated_length_m, 
    colour = Sensor)) +
  geom_point() +
  geom_abline() +
  #annotate(
  #  "text", 
  #  x = 50, y = 175, 
  #  label = paste0("average difference = ", round(avg_diff, digits = 1)," m.")) +
  labs(
    title = "Difference between reported and calculated track length",
    x = "Reported track length (m)", 
    y = "Estimated track length (m)") +
  xlim(0, max(c(tidy$Track_dist_m, tidy$Estimated_length_m), na.rm = T)) +
  ylim(0, max(c(tidy$Track_dist_m, tidy$Estimated_length_m), na.rm = T)) +
  coord_fixed() +
  theme_bw()
plot
```

## Reported species names
Which reported species names could not be matched to WoRMS?
```{r}
print(species_additions %>%
  select(Species_reported, valid_name) %>%
  filter(is.na(valid_name))
)
```

Which species were matched fuzzy?
```{r}
print(species_additions %>%
  .[-which(.$hasNoMatch == 1),] %>%
  filter(isFuzzy == 1) %>%
  select(Species_reported, valid_name) %>%
  distinct()
)
  
```

Hierarchical dendrogram.
